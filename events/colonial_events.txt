namespace = cultural_influence_colonial

province_event = { #Established colonial centre (Converts a heavily developed province of the Colonizer)
	id = cultural_influence_colonial.1
	title = colonial_capital_established.title
	desc = colonial_capital_established.desc
	picture = GREAT_BUILDING_eventPicture

	major = yes #Maybe annoying, but this is a very significant event for the colonial powers

	trigger = {
		is_owned_by_trade_company = yes
		development = 40 #At least 40 dev needed
		#Altogether these investments cost 1600 ducats, and you are limited to one per company
		has_trade_company_investment_in_area = { #Has the required investments
			investment = district
			investor = OWNER
		}
		has_trade_company_investment_in_area = { #Has the required investments (Only one top-tier investment allowed per trade node as of 1.30, But I'm still going to require this, as this is a-historically overrepresenting the colonialists already, and since I've loosened it to one per superregion I like this being an investment that has a high opportunity cost)
			investment = townships
			investor = OWNER
		}
		has_building = university #Serves as a tech gate here (1622)
		province_has_center_of_trade_of_level = 2
		#Highest dev in area check goes here, but it doesn't exist so I'm just going with the University building and then only allowing this to happen once in the area
		NOT = { has_province_modifier = colonial_capital_province_modifier }
		#Check for Superregion (Cannot find a way to do this dynamically)
		if = {
			limit = {
				superregion = europe_superregion #Western Europe
			}
			NOT = {
				OWNER = {
					any_owned_province = {
						has_province_modifier = colonial_capital_province_modifier
						superregion = europe_superregion #Western Europe
					}
				}
			}
		}
		else_if = {
			limit = {
				superregion = eastern_europe_superregion
			}
			NOT = {
				OWNER = {
					any_owned_province = {
						has_province_modifier = colonial_capital_province_modifier
						superregion = eastern_europe_superregion
					}
				}
			}
		}
		else_if = {
			limit = {
				superregion = africa_superregion
			}
			NOT = {
				OWNER = {
					any_owned_province = {
						has_province_modifier = colonial_capital_province_modifier
						superregion = africa_superregion
					}
				}
			}
		}
		else_if = {
			limit = {
				superregion = near_east_superregion
			}
			NOT = {
				OWNER = {
					any_owned_province = {
						has_province_modifier = colonial_capital_province_modifier
						superregion = near_east_superregion
					}
				}
			}
		}
		else_if = {
			limit = {
				superregion = persia_superregion
			}
			NOT = {
				OWNER = {
					any_owned_province = {
						has_province_modifier = colonial_capital_province_modifier
						superregion = persia_superregion
					}
				}
			}
		}
		else_if = {
			limit = {
				superregion = tartary_superregion
			}
			NOT = {
				OWNER = {
					any_owned_province = {
						has_province_modifier = colonial_capital_province_modifier
						superregion = tartary_superregion
					}
				}
			}
		}
		else_if = {
			limit = {
				superregion = india_superregion
			}
			NOT = {
				OWNER = {
					any_owned_province = {
						has_province_modifier = colonial_capital_province_modifier
						superregion = india_superregion
					}
				}
			}
		}
		else_if = {
			limit = {
				superregion = china_superregion
			}
			NOT = {
				OWNER = {
					any_owned_province = {
						has_province_modifier = colonial_capital_province_modifier
						superregion = china_superregion
					}
				}
			}
		}
		else_if = {
			limit = {
				superregion = far_east_superregion
			}
			NOT = {
				OWNER = {
					any_owned_province = {
						has_province_modifier = colonial_capital_province_modifier
						superregion = far_east_superregion
					}
				}
			}
		}
		else_if = {
			limit = {
				superregion = east_indies_superregion
			}
			NOT = {
				OWNER = {
					any_owned_province = {
						has_province_modifier = colonial_capital_province_modifier
						superregion = east_indies_superregion
					}
				}
			}
		}
		else_if = {
			limit = {
				superregion = oceania_superregion
			}
			NOT = {
				OWNER = {
					any_owned_province = {
						has_province_modifier = colonial_capital_province_modifier
						superregion = oceania_superregion
					}
				}
			}
		}
	}

	mean_time_to_happen = {
		months = 30
	}

	option = { #Convert
		name = colonial_capital_established.a

		add_adm_power = -300
		add_dip_power = -200
		change_culture = OWNER
		change_religion = OWNER

		add_base_production = 4
		add_province_modifier = {
			name = colonial_capital_province_modifier
			duration = -1
		}

		ai_chance = { #AI does this one
			factor = 1
		}
	}

	option = { #No, preserve the indigenous populace
		name = colonial_capital_established.b

		add_base_production = 4
		add_province_modifier = {
			name = colonial_capital_province_modifier
			duration = -1
		}

		ai_chance = { 
			factor = 0
		}
	}
}

#Generic event spreading your primary culture through native provinces in Colonial regions. Ideally I want creoles and dynamic evolution of cultures, but until then this will do
province_event = { #Basic Colonial Settlement Event
	id = cultural_influence_colonial.2
	title = colonial_settlement.title
	desc = colonial_settlement.desc
	picture = CULTURE_eventPicture
	
	trigger = {
		native_american_trigger = yes #Native cultures
		NOT = { religion_group = pagan } #Will cause issues for Colonialist Pagans, but any European Neo-Pagans would likely not want to convert them anyways
		AND = { #Not Native
			OWNER = { NOT = { technology_group = north_american } }
			OWNER = { NOT = { technology_group = mesoamerican } }
			OWNER = { NOT = { technology_group = south_american } }
			OWNER = { NOT = { technology_group = andean } }
		}
	}

	mean_time_to_happen = {
		#Template Settled MTTH
		years = 30

		modifier = {
			factor = 0.8
			has_idea_to_settle_faster = yes
		}
		modifier = {
			factor = 0.8
			OR = {
				is_colonial_nation = yes
				is_former_colonial_nation = yes
			}
		}
		modifier = {
			factor = 0.6
			any_neighbor_province = {
				culture = OWNER
			}
		}
	}

	option = {
		name = colonial_settlement.a

		change_culture = OWNER
	}
}

province_event = { #Generic Merchant Republic Colonies
	id = cultural_influence_colonial.3
	title = generic_merchant_colonies.title
	desc = generic_merchant_colonies.desc
	picture = MERCHANTS_TALKING_eventPicture

	trigger = {
		always = no #Disabling this for now, I'm going to work on something else, I can't figure out a way to make this work how I want it to...

		owner = { has_government_attribute = is_merchant_republic }
		has_port = yes #Coastal
		OR = { #Has trade building (AI won't have issues with this, they build plenty of buildings)
			has_building = marketplace
			has_building = trade_depot
			has_building = stock_exchange
		}
		NOT = { nationalism = 1 }
	}

	mean_time_to_happen = {
		years = 40


	}

	option = { #Approve
		name = generic_merchant_colonies.a

		change_culture = OWNER
		change_religion = OWNER
	}

	option = { #Cease
		name = generic_merchant_colonies.b
	}
}

#Attempts to preserve pre-colonial cultures
province_event = { #Colony Finished
	id = cultural_influence_colonial.100
	title = null
	desc = null
	picture = null

	hidden = yes

	trigger = {
		is_city = yes
		has_province_flag = ci_set_pre_colonial_culture_var
	}

	immediate = { #Vars and flag set in scripted effect
		change_culture = variable:pre_colonial_culture_var
		change_religion = variable:pre_colonial_religion_var
		clr_province_flag = ci_set_pre_colonial_culture_var
	}

	option = {
		name = null
	}
}